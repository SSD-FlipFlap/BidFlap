<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ko">
<head>
    <link rel="stylesheet" type="text/css" th:href="@{/resources/css/main/main.css}">
    <title>메인페이지-로그인</title>
    <script th:inline="javascript">
        document.addEventListener('DOMContentLoaded', function() {
            let loginSuccess = [[${loginSuccess}]];
            if (loginSuccess) {
                const memberNickname = [[${session.loggedInMember}]];
                alert(memberNickname + '님, 로그인 되었습니다.');
            }
        });

        function filterProductsByCategory(categoryName) {
            // 선택한 카테고리에 따라 상품 필터링 및 표시
            const productRows = document.querySelectorAll('.product_images .image_row');
            productRows.forEach(row => {
                const products = row.querySelectorAll('.image_container');
                products.forEach(product => {
                    const category = product.getAttribute('data-category');
                    if (category === categoryName || categoryName === '전체') {
                        product.style.display = 'block';
                    } else {
                        product.style.display = 'none';
                    }
                });
            });
        }

    </script>
</head>
<body>
<div th:include="thyme/HeaderWithCategory"></div>

<div th:if="${logoutSuccess}">
    <script th:inline="javascript">
        alert("로그아웃 되었습니다.");
    </script>
</div>

<div class="main-container">
        <div class="main-frame">
            <img th:src="@{/resources/img/main_frame.png}" alt="Product 1">
        </div>
        <div class="search-container">
            <form action="/product/list" method="get">
                <input type="text" name="keyword" class="search-input" placeholder="원하는 제품을 검색해보세요">
                <button type="submit">검색</button>
            </form>
        </div>
        <br/>
        <br/>
        <br/>
    <div th:if="${session.loggedInMember != null}">
        <div class="recommendations-container" th:text="${session.loggedInMember + '님을 위한 추천 상품'}"></div>

        <!-- 관심 카테고리가 있는 경우 -->
        <div th:if="${interests != null and #lists.size(interests) > 0}">
            <div class="recommendations-category">
                <span th:each="category, iterStat : ${interests}">
                    <button th:text="${category.name}" th:attr="onclick='filterProductsByCategory(\'' + ${category.name} + '\')'"></button>
                    <span th:if="${!iterStat.last}"> | </span>
                </span>
            </div>

            <!-- 선택한 카테고리에 따라 상품 이미지 노출 -->
            <div class="product_images">
                <div class="image_row" th:each="product : ${recommendedProducts}">
                    <div class="image_container" th:attr="data-category=${product.category}">
                        <a th:href="@{'/product/view?id=' + ${product.id}}">
                            <div class="image_and_heart_container">
                                <img th:src="@{/resources/img/product_example.png}" alt="Product Image" class="product_img">
                                <img th:src="@{/resources/img/heart.png}" alt="heart" class="heart_icon">
                            </div>
                            <p th:text="${product.price} + '원'"></p>
                        </a>
                    </div>
                </div>
            </div>
        </div>



        <!-- 로그인 유저 : 관심 카테고리가 없는 경우. 좋아요 순 정렬 -->
        <div class="product_images" th:unless="${interests != null and #lists.size(interests) > 0}">
            <div class="image_row" th:each="product : ${recommendedProducts}">

                <div class="image_container">
                    <a th:href="@{'/product/view?id=' + ${product.id}}">
                    <div class="image_and_heart_container">
                        <img th:src="@{/resources/img/product_example.png}" alt="Product Image" class="product_img">
                        <img th:src="@{/resources/img/heart.png}" alt="heart" class="heart_icon">
                    </div>
                    <p th:text="${product.price} + '원'"></p></a>
                </div>
            </div>
        </div>

    </div>

    <div th:if="${session.loggedInMember == null}"> <!--로그아웃 알고리즘 좋아요 순 추천-->
        <div class="recommendations-container">요즘 뜨는 상품</div>

        <div class="product_images">
            <div class="image_row" th:each="product,iterStat : ${popularProducts}">
                <!--상품 이미지 정보 -->
                <div class="image_container">
                    <a th:href="@{'/product/view?id=' + ${product.id}}">
                    <div class="image_and_heart_container">
                        <img th:src="@{/resources/img/product_example.png}" alt="Product Image" class="product_img">
                        <img th:src="@{/resources/img/heart.png}" alt="heart" class="heart_icon">
                    </div>
                        <p th:text="${product.price} + '원'"></p></a>
                </div>
                <div th:if="${iterStat.count % 4 == 0}"></div>
            </div>
        </div>
    </div>

<!-- 오른쪽 빈 공간 -->
<div class="empty_space"></div>
<!-- 선택 창 -->
<div class="selection-box">

    <a href=""> 내 경매</a><br/><br/><br/>
    <a href=""> 좋아요한 목록</a><br/><br/><br/>
    <a href=""> AS 서비스</a> <br/><br/><br/>
    <a href="/product/register"> 판매글 등록</a><br/><br/><br/>
</div>
</div>

</body>
</html>
